# 程序依赖安装

## 安装gcc
cd /tmp/gcc-build-6.1.0/gcc-6.1.0
./contrib/download_prerequisites
./gcc-6.1.0/configure --prefix=/usr/local/ --enable-checking=release --enable-languages=c,c++ --disable-multilib
#./gcc-6.1.0/configure --prefix=/usr/local/gcc-6.1.0 --enable-checking=release --enable-languages=c,c++ --disable-multilib
make -j64
make install
cd /usr/local/bin/
./gcc -v

cd /usr/bin/
mv gcc gcc_back
mv g++ g++_back
ln -s /usr/local/bin/gcc gcc
ln -s /usr/local/bin/g++ g++


解决运行程序gcc出现'GLIBCXX_3.4.21' not found
strings /lib64/libstdc++.so.6 | grep GLIBC

cp /usr/local/lib64/libstdc++.so.6.0.22 /usr/lib64/
cd /usr/lib64/
rm  libstdc++.so.6 -rf
ln -s libstdc++.so.6.0.22 libstdc++.so.6

strings /lib64/libstdc++.so.6 | grep GLIBC

#使用环境变量的方式替代软链ll
#vi /root/.bashrc
#g c c 、 g + + 环 境 变 量 设 置 
#export CC=/usr/local/gcc-6.1.0/bin/gcc
#export CXX=/usr/local/gcc-6.1.0/bin/g++
#将 g c c 的 l i b 库 设 置 到 环 境 中 来 。 后 ⾯ 编 译 其 他 ⼯ 具 ⽤ 得 到 。
#export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/gcc6.1.0/lib:/usr/local/gcc-6.1.0/lib64
#export PATH=/usr/local/gcc-6.1.0/bin:$PATH


## 安装glibc
ldd --version
cd /tmp/glibc-build-2.23/

yum install gperf -y
../glibc-2.23/configure --prefix=/usr
make
#make check
make install

报错 setenv.c:279:6: error: suggest explicit braces to avoid ambiguous 'else' [-Werror=parentheses]
https://blog.csdn.net/gx1313113/article/details/101154742
vi /tmp/glibc-build-2.23/glibc-2.23/nis/nis_call.c
683 {
694 }
vi /tmp/glibc-build-2.23/glibc-2.23/stdlib/setenv.c
280 {
294 }

#另开页面
cd /user/lib64/
ll libm*
ln -sf libm-2.23.so libm.so.6


## 安装yasm
cd yasm-1.3.0/
mkdir build && cd build 
../configure
make -j all
make install 
yasm --version


## 安装ffmpeg
mkdir ffmpeg/build
cd ffmpeg/build
../configure --enable-shared 
make 
make install

vi .bashrc 
#ffmpeg: error while loading shared libraries: libavdevice.so.58: cannot open shared object file: No such file or directory
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib

## 安装eigen3
cd eigen-3.3.7/
mkdir build && cd build 
cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_CXX_COMPILER=/usr/bin/g++ ..
make install

## cmake安装
./bootstrap 
make
make install


## 安装opencv-3.4.9
vi /root/.bashrc
export LD_LIBRARY_PATH=/usr/local/cuda/lib64:$LD_LIBRARY_PATH
export CUDA_HOME=/usr/local/cuda
export PATH=$CUDA_HOME/bin:$PATH
export CUDNN_HOME=/usr/local/cuda
export CUDNN_INCLUDE_DIR=/usr/local/cuda/include
export CUDNN_LIBRARY=/usr/local/cuda/lib64
export CUDNN_LIBRARY_PATH=/usr/local/cuda
su - ultron

cd /tmp/opencv-build-3.4.9/opencv-3.4.9/
mkdir build && cd build ls

#/tmp/opencv-3.4.9/modules/core/include/opencv2/core/cuda/vec_math.hpp(205): error: calling a constexpr __host__ function("abs") from a __device__ function("abs") is not allowed. The experimental flag '--expt-relaxed-constexpr' can be used to allow this.
vi modules/core/include/opencv2/core/cuda/vec_math.hpp
把203行和205行的 ::abs 也注释掉


cmake -DCMAKE_BUILD_TYPE=RELEASE -DCMAKE_INSTALL_PREFIX=/usr -DOPENCV_EXTRA_MODULES_PATH=/usr/local/opencv-3.2.0/opencv_contrib/modules -DWITH_CUDA=ON-D CUDA_TOOLKIT_ROOT_DIR=/usr/local/cuda -DWITH_CUBLAS=ON DCUDA_FAST_MATH=ON -D WITH_CUFFT=ON -DWITH_NVCUVID=OFF -DWITH_FFMPEG=ON -D BUILD_EXAMPLES=OFF -DENABLE_PRECOMPILED_HEADERS=OFF ..  
make -j 64
make install



#/usr/local/opencv-3.4.9/modules/stitching/include/opencv2/stitching.hpp:49
     49 #include "/usr/local/opencv-3.4.9/modules/stitching/include/opencv2/stitching/detail/matchers.hpp"

#/usr/local/opencv-3.4.9/modules/stitching/src/precomp.hpp:59
     59 #include "/usr/local/opencv-3.4.9/modules/stitching/include/opencv2/stitching.hpp"
     
#/usr/local/opencv-3.4.9/modules/stitching/src/seam_finders.cpp:43
     43 #include "/usr/local/opencv-3.4.9/modules/stitching/src/precomp.hpp"
     
#/usr/local/opencv-3.4.9/modules/stitching/include/opencv2/stitching/detail/matchers.hpp:52   #opencv2/xfeatures2d/cuda.hpp: No such file or directory
     52 #  include "/usr/local/opencv-3.4.9/opencv_contrib-3.4.9/modules/xfeatures2d/include/opencv2/xfeatures2d/cuda.hpp"


cd opencv-build-3.4.9/opencv-3.4.9/samples/cpp/example_cmake
make
./opencv_example


pkg-config --cflags opencv
pkg-config --modversion opencv


## 安装opencv-4.2.0
yum install openssl-devel readline readline-devel zlib* libffi-devel -y

python3软链
ln -sf /usr/bin/python3 /usr/bin/python

cmake -DCMAKE_BUILD_TYPE=RELEASE -DCMAKE_INSTALL_PREFIX=/usr -DOPENCV_EXTRA_MODULES_PATH=/usr/local/opencv-4.2.0/opencv_contrib/modules -DWITH_CUDA=ON-D -DCUDA_nppi_LIBRARY=true CUDA_TOOLKIT_ROOT_DIR=/usr/local/cuda -DWITH_CUBLAS=ON DCUDA_FAST_MATH=ON -D WITH_CUFFT=ON -DWITH_NVCUVID=OFF -DWITH_FFMPEG=ON -D BUILD_EXAMPLES=OFF -DENABLE_PRECOMPILED_HEADERS=OFF -DBUILD_TESTS=OFF  -DWITH_GTK=OFF  ..  
cmake -D WITH_NVCUVID=ON -D BUILD_DOCS=ON -D WITH_XINE=ON -D WITH_CUDA=ON -D WITH_OPENGL=ON -D WITH_TBB=ON -D WITH_OPENNI=ON -D BUILD_EXAMPLES=ON -D WITH_OPENCL=ON -D CMAKE_BUILD_TYPE=RELEASE -D OPENCV_EXTRA_MODULES_PATH=/usr/opencv-4.2.0/opencv_contrib/modules -D ENABLE_FAST_MATH=1 -D WITH_QT=ON -D CUDA_FAST_MATH=1 -D WITH_CUBLAS=1 -D CMAKE_INSTALL_PREFIX=/usr/ ..


https://blog.csdn.net/dawn_chen121/article/details/82828629
opencv-build-4.2.0/opencv-4.2.0/opencv_contrib/modules/cudev/include/opencv2/cudev

  CUDA backend for DNN module requires CC 5.3 or higher.  Please remove
  unsupported architectures from CUDA_ARCH_BIN option.
CUDA_ARCH_BIN
vim opencv/cmake/OpenCVDetectCUDA.cmake +140
set(__cuda_arch_bin "3.0 3.5 3.7 5.0 5.2 6.0 6.1 7.0 7.5") ->改为-> set(__cuda_arch_bin "6.0 6.1 7.0 7.5")

https://blog.csdn.net/windrainlife/article/details/52217367
https://answers.opencv.org/users/18948/abhiguru/?sort=recent

## https://www.cnblogs.com/kevingrace/p/9599988.html
docker commit d0ce687f5ded hub.iflytek.com/ultron/nvidia/cuda:10.1-cudnn7-devel-gcc-centos7

docker run -itd  --name test1 hub.iflytek.com/ultron/nvidia/cuda:10.1-cudnn7-devel-centos7  /bin/bash
docker cp gcc-build-6.1.0 d0ce687f5ded:/tmp/
docker exec -it d0ce687f5ded /bin/bash
usradd ultron
yum install wget bzip2 make cmake texinfo
docker commit d0ce687f5ded hub.iflytek.com/ultron/nvidia/cuda:10.1-cudnn7-devel-gcc-centos7

docker run -itd  --name test2 hub.iflytek.com/ultron/nvidia/cuda:10.1-cudnn7-devel-gcc-centos7  /bin/bash
docker cp glibc-build-2.23  65ad5245cb50:/tmp/
docker exec -it 65ad5245cb50 /bin/bash
docker commit 65ad5245cb50 hub.iflytek.com/ultron/nvidia/cuda:10.1-cudnn7-devel-gcc-glibc-centos7

docker run -itd  --name test3 hub.iflytek.com/ultron/nvidia/cuda:10.1-cudnn7-devel-gcc-glibc-centos7  /bin/bash
docker cp other  45aa43ff3a34:/tmp/
docker exec -it 45aa43ff3a34 /bin/bash
docker commit 45aa43ff3a34 hub.iflytek.com/ultron/nvidia/cuda:10.1-cudnn7-devel-other-gcc-glibc-centos7

docker run -itd  --name test2 hub.iflytek.com/ultron/nvidia/cuda:10.1-cudnn7-devel-other-gcc-glibc-centos7  /bin/bash
docker cp opencv-build-3.4.9  aa1673f5b80c:/usr/local/
docker cp *  aa1673f5b80c:/tmp/opencv-build-3.4.9/opencv-3.4.9/opencv_contrib-3.4.9/modules/xfeatures2d/src/
docker exec -it aa1673f5b80c /bin/bash
docker commit aa1673f5b80c hub.iflytek.com/ultron/nvidia/cuda:10.1-cudnn7-gcc6.1.0-opencv-3.4.9-devel-centos7

docker run -itd  --name test2 hub.iflytek.com/ultron/nvidia/cuda:10.1-cudnn7-devel-other-gcc-glibc-centos7-base3   /bin/bash
docker cp opencv-build-4.2.0  d0a2b74e77a2:/tmp/
docker exec -it d0a2b74e77a2 /bin/bash
docker commit d0a2b74e77a2 hub.iflytek.com/ultron/nvidia/cuda:10.1-cudnn7-devel-other-gcc-glibc-centos7-base3

 